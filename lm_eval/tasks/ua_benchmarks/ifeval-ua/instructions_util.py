# Copyright 2023 The Google Research Authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

"""Utility library of instructions."""

import functools
import os
import random
import re
from importlib.metadata import version

import immutabledict
import nltk
from packaging.version import parse as parse_version


# Downloading 'punkt' with nltk<3.9 has a remote code vuln.
# see  https://github.com/EleutherAI/lm-evaluation-harness/issues/2210
# and https://github.com/nltk/nltk/issues/3266
# for more information.
NLTK_MIN_VERSION = "3.9.1"
RANK = os.environ.get("LOCAL_RANK", "0")


def download_nltk_resources():
    """Download 'punkt' if not already installed"""
    assert (nltk_version := parse_version(version("nltk"))) >= parse_version(
        NLTK_MIN_VERSION
    ), (
        f"`nltk` version {nltk_version} is not >= {NLTK_MIN_VERSION}. Please update `nltk` before proceeding--older versions are vulnerable to a remote code execution vulnerability."
    )

    try:
        nltk.data.find("tokenizers/punkt_tab")
    except LookupError:
        if RANK == "0":
            nltk.download("punkt_tab")
            print("Downloaded punkt_tab on rank 0")


download_nltk_resources()

WORD_LIST = [
    "western",
    "sentence",
    "signal",
    "dump",
    "spot",
    "opposite",
    "bottom",
    "potato",
    "administration",
    "working",
    "welcome",
    "morning",
    "good",
    "agency",
    "primary",
    "wish",
    "responsibility",
    "press",
    "problem",
    "president",
    "steal",
    "brush",
    "read",
    "type",
    "beat",
    "trainer",
    "growth",
    "lock",
    "bone",
    "case",
    "equal",
    "comfortable",
    "region",
    "replacement",
    "performance",
    "mate",
    "walk",
    "medicine",
    "film",
    "thing",
    "rock",
    "tap",
    "total",
    "competition",
    "ease",
    "south",
    "establishment",
    "gather",
    "parking",
    "world",
    "plenty",
    "breath",
    "claim",
    "alcohol",
    "trade",
    "dear",
    "highlight",
    "street",
    "matter",
    "decision",
    "mess",
    "agreement",
    "studio",
    "coach",
    "assist",
    "brain",
    "wing",
    "style",
    "private",
    "top",
    "brown",
    "leg",
    "buy",
    "procedure",
    "method",
    "speed",
    "high",
    "company",
    "valuable",
    "pie",
    "analyst",
    "session",
    "pattern",
    "district",
    "pleasure",
    "dinner",
    "swimming",
    "joke",
    "order",
    "plate",
    "department",
    "motor",
    "cell",
    "spend",
    "cabinet",
    "difference",
    "power",
    "examination",
    "engine",
    "horse",
    "dimension",
    "pay",
    "toe",
    "curve",
    "literature",
    "bother",
    "fire",
    "possibility",
    "debate",
    "activity",
    "passage",
    "hello",
    "cycle",
    "background",
    "quiet",
    "author",
    "effect",
    "actor",
    "page",
    "bicycle",
    "error",
    "throat",
    "attack",
    "character",
    "phone",
    "tea",
    "increase",
    "outcome",
    "file",
    "specific",
    "inspector",
    "internal",
    "potential",
    "staff",
    "building",
    "employer",
    "shoe",
    "hand",
    "direction",
    "garden",
    "purchase",
    "interview",
    "study",
    "recognition",
    "member",
    "spiritual",
    "oven",
    "sandwich",
    "weird",
    "passenger",
    "particular",
    "response",
    "reaction",
    "size",
    "variation",
    "a",
    "cancel",
    "candy",
    "exit",
    "guest",
    "condition",
    "fly",
    "price",
    "weakness",
    "convert",
    "hotel",
    "great",
    "mouth",
    "mind",
    "song",
    "sugar",
    "suspect",
    "telephone",
    "ear",
    "roof",
    "paint",
    "refrigerator",
    "organization",
    "jury",
    "reward",
    "engineering",
    "day",
    "possession",
    "crew",
    "bar",
    "road",
    "description",
    "celebration",
    "score",
    "mark",
    "letter",
    "shower",
    "suggestion",
    "sir",
    "luck",
    "national",
    "progress",
    "hall",
    "stroke",
    "theory",
    "offer",
    "story",
    "tax",
    "definition",
    "history",
    "ride",
    "medium",
    "opening",
    "glass",
    "elevator",
    "stomach",
    "question",
    "ability",
    "leading",
    "village",
    "computer",
    "city",
    "grand",
    "confidence",
    "candle",
    "priest",
    "recommendation",
    "point",
    "necessary",
    "body",
    "desk",
    "secret",
    "horror",
    "noise",
    "culture",
    "warning",
    "water",
    "round",
    "diet",
    "flower",
    "bus",
    "tough",
    "permission",
    "week",
    "prompt",
    "connection",
    "abuse",
    "height",
    "save",
    "corner",
    "border",
    "stress",
    "drive",
    "stop",
    "rip",
    "meal",
    "listen",
    "confusion",
    "girlfriend",
    "living",
    "relation",
    "significance",
    "plan",
    "creative",
    "atmosphere",
    "blame",
    "invite",
    "housing",
    "paper",
    "drink",
    "roll",
    "silver",
    "drunk",
    "age",
    "damage",
    "smoke",
    "environment",
    "pack",
    "savings",
    "influence",
    "tourist",
    "rain",
    "post",
    "sign",
    "grandmother",
    "run",
    "profit",
    "push",
    "clerk",
    "final",
    "wine",
    "swim",
    "pause",
    "stuff",
    "singer",
    "funeral",
    "average",
    "source",
    "scene",
    "tradition",
    "personal",
    "snow",
    "nobody",
    "distance",
    "sort",
    "sensitive",
    "animal",
    "major",
    "negotiation",
    "click",
    "mood",
    "period",
    "arrival",
    "expression",
    "holiday",
    "repeat",
    "dust",
    "closet",
    "gold",
    "bad",
    "sail",
    "combination",
    "clothes",
    "emphasis",
    "duty",
    "black",
    "step",
    "school",
    "jump",
    "document",
    "professional",
    "lip",
    "chemical",
    "front",
    "wake",
    "while",
    "inside",
    "watch",
    "row",
    "subject",
    "penalty",
    "balance",
    "possible",
    "adult",
    "aside",
    "sample",
    "appeal",
    "wedding",
    "depth",
    "king",
    "award",
    "wife",
    "blow",
    "site",
    "camp",
    "music",
    "safe",
    "gift",
    "fault",
    "guess",
    "act",
    "shame",
    "drama",
    "capital",
    "exam",
    "stupid",
    "record",
    "sound",
    "swing",
    "novel",
    "minimum",
    "ratio",
    "machine",
    "shape",
    "lead",
    "operation",
    "salary",
    "cloud",
    "affair",
    "hit",
    "chapter",
    "stage",
    "quantity",
    "access",
    "army",
    "chain",
    "traffic",
    "kick",
    "analysis",
    "airport",
    "time",
    "vacation",
    "philosophy",
    "ball",
    "chest",
    "thanks",
    "place",
    "mountain",
    "advertising",
    "red",
    "past",
    "rent",
    "return",
    "tour",
    "house",
    "construction",
    "net",
    "native",
    "war",
    "figure",
    "fee",
    "spray",
    "user",
    "dirt",
    "shot",
    "task",
    "stick",
    "friend",
    "software",
    "promotion",
    "interaction",
    "surround",
    "block",
    "purpose",
    "practice",
    "conflict",
    "routine",
    "requirement",
    "bonus",
    "hole",
    "state",
    "junior",
    "sweet",
    "catch",
    "tear",
    "fold",
    "wall",
    "editor",
    "life",
    "position",
    "pound",
    "respect",
    "bathroom",
    "coat",
    "script",
    "job",
    "teach",
    "birth",
    "view",
    "resolve",
    "theme",
    "employee",
    "doubt",
    "market",
    "education",
    "serve",
    "recover",
    "tone",
    "harm",
    "miss",
    "union",
    "understanding",
    "cow",
    "river",
    "association",
    "concept",
    "training",
    "recipe",
    "relationship",
    "reserve",
    "depression",
    "proof",
    "hair",
    "revenue",
    "independent",
    "lift",
    "assignment",
    "temporary",
    "amount",
    "loss",
    "edge",
    "track",
    "check",
    "rope",
    "estimate",
    "pollution",
    "stable",
    "message",
    "delivery",
    "perspective",
    "mirror",
    "assistant",
    "representative",
    "witness",
    "nature",
    "judge",
    "fruit",
    "tip",
    "devil",
    "town",
    "emergency",
    "upper",
    "drop",
    "stay",
    "human",
    "neck",
    "speaker",
    "network",
    "sing",
    "resist",
    "league",
    "trip",
    "signature",
    "lawyer",
    "importance",
    "gas",
    "choice",
    "engineer",
    "success",
    "part",
    "external",
    "worker",
    "simple",
    "quarter",
    "student",
    "heart",
    "pass",
    "spite",
    "shift",
    "rough",
    "lady",
    "grass",
    "community",
    "garage",
    "youth",
    "standard",
    "skirt",
    "promise",
    "blind",
    "television",
    "disease",
    "commission",
    "positive",
    "energy",
    "calm",
    "presence",
    "tune",
    "basis",
    "preference",
    "head",
    "common",
    "cut",
    "somewhere",
    "presentation",
    "current",
    "thought",
    "revolution",
    "effort",
    "master",
    "implement",
    "republic",
    "floor",
    "principle",
    "stranger",
    "shoulder",
    "grade",
    "button",
    "tennis",
    "police",
    "collection",
    "account",
    "register",
    "glove",
    "divide",
    "professor",
    "chair",
    "priority",
    "combine",
    "peace",
    "extension",
    "maybe",
    "evening",
    "frame",
    "sister",
    "wave",
    "code",
    "application",
    "mouse",
    "match",
    "counter",
    "bottle",
    "half",
    "cheek",
    "resolution",
    "back",
    "knowledge",
    "make",
    "discussion",
    "screw",
    "length",
    "accident",
    "battle",
    "dress",
    "knee",
    "log",
    "package",
    "it",
    "turn",
    "hearing",
    "newspaper",
    "layer",
    "wealth",
    "profile",
    "imagination",
    "answer",
    "weekend",
    "teacher",
    "appearance",
    "meet",
    "bike",
    "rise",
    "belt",
    "crash",
    "bowl",
    "equivalent",
    "support",
    "image",
    "poem",
    "risk",
    "excitement",
    "remote",
    "secretary",
    "public",
    "produce",
    "plane",
    "display",
    "money",
    "sand",
    "situation",
    "punch",
    "customer",
    "title",
    "shake",
    "mortgage",
    "option",
    "number",
    "pop",
    "window",
    "extent",
    "nothing",
    "experience",
    "opinion",
    "departure",
    "dance",
    "indication",
    "boy",
    "material",
    "band",
    "leader",
    "sun",
    "beautiful",
    "muscle",
    "farmer",
    "variety",
    "fat",
    "handle",
    "director",
    "opportunity",
    "calendar",
    "outside",
    "pace",
    "bath",
    "fish",
    "consequence",
    "put",
    "owner",
    "go",
    "doctor",
    "information",
    "share",
    "hurt",
    "protection",
    "career",
    "finance",
    "force",
    "golf",
    "garbage",
    "aspect",
    "kid",
    "food",
    "boot",
    "milk",
    "respond",
    "objective",
    "reality",
    "raw",
    "ring",
    "mall",
    "one",
    "impact",
    "area",
    "news",
    "international",
    "series",
    "impress",
    "mother",
    "shelter",
    "strike",
    "loan",
    "month",
    "seat",
    "anything",
    "entertainment",
    "familiar",
    "clue",
    "year",
    "glad",
    "supermarket",
    "natural",
    "god",
    "cost",
    "conversation",
    "tie",
    "ruin",
    "comfort",
    "earth",
    "storm",
    "percentage",
    "assistance",
    "budget",
    "strength",
    "beginning",
    "sleep",
    "other",
    "young",
    "unit",
    "fill",
    "store",
    "desire",
    "hide",
    "value",
    "cup",
    "maintenance",
    "nurse",
    "function",
    "tower",
    "role",
    "class",
    "camera",
    "database",
    "panic",
    "nation",
    "basket",
    "ice",
    "art",
    "spirit",
    "chart",
    "exchange",
    "feedback",
    "statement",
    "reputation",
    "search",
    "hunt",
    "exercise",
    "nasty",
    "notice",
    "male",
    "yard",
    "annual",
    "collar",
    "date",
    "platform",
    "plant",
    "fortune",
    "passion",
    "friendship",
    "spread",
    "cancer",
    "ticket",
    "attitude",
    "island",
    "active",
    "object",
    "service",
    "buyer",
    "bite",
    "card",
    "face",
    "steak",
    "proposal",
    "patient",
    "heat",
    "rule",
    "resident",
    "broad",
    "politics",
    "west",
    "knife",
    "expert",
    "girl",
    "design",
    "salt",
    "baseball",
    "grab",
    "inspection",
    "cousin",
    "couple",
    "magazine",
    "cook",
    "dependent",
    "security",
    "chicken",
    "version",
    "currency",
    "ladder",
    "scheme",
    "kitchen",
    "employment",
    "local",
    "attention",
    "manager",
    "fact",
    "cover",
    "sad",
    "guard",
    "relative",
    "county",
    "rate",
    "lunch",
    "program",
    "initiative",
    "gear",
    "bridge",
    "breast",
    "talk",
    "dish",
    "guarantee",
    "beer",
    "vehicle",
    "reception",
    "woman",
    "substance",
    "copy",
    "lecture",
    "advantage",
    "park",
    "cold",
    "death",
    "mix",
    "hold",
    "scale",
    "tomorrow",
    "blood",
    "request",
    "green",
    "cookie",
    "church",
    "strip",
    "forever",
    "beyond",
    "debt",
    "tackle",
    "wash",
    "following",
    "feel",
    "maximum",
    "sector",
    "sea",
    "property",
    "economics",
    "menu",
    "bench",
    "try",
    "language",
    "start",
    "call",
    "solid",
    "address",
    "income",
    "foot",
    "senior",
    "honey",
    "few",
    "mixture",
    "cash",
    "grocery",
    "link",
    "map",
    "form",
    "factor",
    "pot",
    "model",
    "writer",
    "farm",
    "winter",
    "skill",
    "anywhere",
    "birthday",
    "policy",
    "release",
    "husband",
    "lab",
    "hurry",
    "mail",
    "equipment",
    "sink",
    "pair",
    "driver",
    "consideration",
    "leather",
    "skin",
    "blue",
    "boat",
    "sale",
    "brick",
    "two",
    "feed",
    "square",
    "dot",
    "rush",
    "dream",
    "location",
    "afternoon",
    "manufacturer",
    "control",
    "occasion",
    "trouble",
    "introduction",
    "advice",
    "bet",
    "eat",
    "kill",
    "category",
    "manner",
    "office",
    "estate",
    "pride",
    "awareness",
    "slip",
    "crack",
    "client",
    "nail",
    "shoot",
    "membership",
    "soft",
    "anybody",
    "web",
    "official",
    "individual",
    "pizza",
    "interest",
    "bag",
    "spell",
    "profession",
    "queen",
    "deal",
    "resource",
    "ship",
    "guy",
    "chocolate",
    "joint",
    "formal",
    "upstairs",
    "car",
    "resort",
    "abroad",
    "dealer",
    "associate",
    "finger",
    "surgery",
    "comment",
    "team",
    "detail",
    "crazy",
    "path",
    "tale",
    "initial",
    "arm",
    "radio",
    "demand",
    "single",
    "draw",
    "yellow",
    "contest",
    "piece",
    "quote",
    "pull",
    "commercial",
    "shirt",
    "contribution",
    "cream",
    "channel",
    "suit",
    "discipline",
    "instruction",
    "concert",
    "speech",
    "low",
    "effective",
    "hang",
    "scratch",
    "industry",
    "breakfast",
    "lay",
    "join",
    "metal",
    "bedroom",
    "minute",
    "product",
    "rest",
    "temperature",
    "many",
    "give",
    "argument",
    "print",
    "purple",
    "laugh",
    "health",
    "credit",
    "investment",
    "sell",
    "setting",
    "lesson",
    "egg",
    "middle",
    "marriage",
    "level",
    "evidence",
    "phrase",
    "love",
    "self",
    "benefit",
    "guidance",
    "affect",
    "you",
    "dad",
    "anxiety",
    "special",
    "boyfriend",
    "test",
    "blank",
    "payment",
    "soup",
    "obligation",
    "reply",
    "smile",
    "deep",
    "complaint",
    "addition",
    "review",
    "box",
    "towel",
    "minor",
    "fun",
    "soil",
    "issue",
    "cigarette",
    "internet",
    "gain",
    "tell",
    "entry",
    "spare",
    "incident",
    "family",
    "refuse",
    "branch",
    "can",
    "pen",
    "grandfather",
    "constant",
    "tank",
    "uncle",
    "climate",
    "ground",
    "volume",
    "communication",
    "kind",
    "poet",
    "child",
    "screen",
    "mine",
    "quit",
    "gene",
    "lack",
    "charity",
    "memory",
    "tooth",
    "fear",
    "mention",
    "marketing",
    "reveal",
    "reason",
    "court",
    "season",
    "freedom",
    "land",
    "sport",
    "audience",
    "classroom",
    "law",
    "hook",
    "win",
    "carry",
    "eye",
    "smell",
    "distribution",
    "research",
    "country",
    "dare",
    "hope",
    "whereas",
    "stretch",
    "library",
    "if",
    "delay",
    "college",
    "plastic",
    "book",
    "present",
    "use",
    "worry",
    "champion",
    "goal",
    "economy",
    "march",
    "election",
    "reflection",
    "midnight",
    "slide",
    "inflation",
    "action",
    "challenge",
    "guitar",
    "coast",
    "apple",
    "campaign",
    "field",
    "jacket",
    "sense",
    "way",
    "visual",
    "remove",
    "weather",
    "trash",
    "cable",
    "regret",
    "buddy",
    "beach",
    "historian",
    "courage",
    "sympathy",
    "truck",
    "tension",
    "permit",
    "nose",
    "bed",
    "son",
    "person",
    "base",
    "meat",
    "usual",
    "air",
    "meeting",
    "worth",
    "game",
    "independence",
    "physical",
    "brief",
    "play",
    "raise",
    "board",
    "she",
    "key",
    "writing",
    "pick",
    "command",
    "party",
    "yesterday",
    "spring",
    "candidate",
    "physics",
    "university",
    "concern",
    "development",
    "change",
    "string",
    "target",
    "instance",
    "room",
    "bitter",
    "bird",
    "football",
    "normal",
    "split",
    "impression",
    "wood",
    "long",
    "meaning",
    "stock",
    "cap",
    "leadership",
    "media",
    "ambition",
    "fishing",
    "essay",
    "salad",
    "repair",
    "today",
    "designer",
    "night",
    "bank",
    "drawing",
    "inevitable",
    "phase",
    "vast",
    "chip",
    "anger",
    "switch",
    "cry",
    "twist",
    "personality",
    "attempt",
    "storage",
    "being",
    "preparation",
    "bat",
    "selection",
    "white",
    "technology",
    "contract",
    "side",
    "section",
    "station",
    "till",
    "structure",
    "tongue",
    "taste",
    "truth",
    "difficulty",
    "group",
    "limit",
    "main",
    "move",
    "feeling",
    "light",
    "example",
    "mission",
    "might",
    "wait",
    "wheel",
    "shop",
    "host",
    "classic",
    "alternative",
    "cause",
    "agent",
    "consist",
    "table",
    "airline",
    "text",
    "pool",
    "craft",
    "range",
    "fuel",
    "tool",
    "partner",
    "load",
    "entrance",
    "deposit",
    "hate",
    "article",
    "video",
    "summer",
    "feature",
    "extreme",
    "mobile",
    "hospital",
    "flight",
    "fall",
    "pension",
    "piano",
    "fail",
    "result",
    "rub",
    "gap",
    "system",
    "report",
    "suck",
    "ordinary",
    "wind",
    "nerve",
    "ask",
    "shine",
    "note",
    "line",
    "mom",
    "perception",
    "brother",
    "reference",
    "bend",
    "charge",
    "treat",
    "trick",
    "term",
    "homework",
    "bake",
    "bid",
    "status",
    "project",
    "strategy",
    "orange",
    "let",
    "enthusiasm",
    "parent",
    "concentrate",
    "device",
    "travel",
    "poetry",
    "business",
    "society",
    "kiss",
    "end",
    "vegetable",
    "employ",
    "schedule",
    "hour",
    "brave",
    "focus",
    "process",
    "movie",
    "illegal",
    "general",
    "coffee",
    "ad",
    "highway",
    "chemistry",
    "psychology",
    "hire",
    "bell",
    "conference",
    "relief",
    "show",
    "neat",
    "funny",
    "weight",
    "quality",
    "club",
    "daughter",
    "zone",
    "touch",
    "tonight",
    "shock",
    "burn",
    "excuse",
    "name",
    "survey",
    "landscape",
    "advance",
    "satisfaction",
    "bread",
    "disaster",
    "item",
    "hat",
    "prior",
    "shopping",
    "visit",
    "east",
    "photo",
    "home",
    "idea",
    "father",
    "comparison",
    "cat",
    "pipe",
    "winner",
    "count",
    "lake",
    "fight",
    "prize",
    "foundation",
    "dog",
    "keep",
    "ideal",
    "fan",
    "struggle",
    "peak",
    "safety",
    "solution",
    "hell",
    "conclusion",
    "population",
    "strain",
    "alarm",
    "measurement",
    "second",
    "train",
    "race",
    "due",
    "insurance",
    "boss",
    "tree",
    "monitor",
    "sick",
    "course",
    "drag",
    "appointment",
    "slice",
    "still",
    "care",
    "patience",
    "rich",
    "escape",
    "emotion",
    "royal",
    "female",
    "childhood",
    "government",
    "picture",
    "will",
    "sock",
    "big",
    "gate",
    "oil",
    "cross",
    "pin",
    "improvement",
    "championship",
    "silly",
    "help",
    "sky",
    "pitch",
    "man",
    "diamond",
    "most",
    "transition",
    "work",
    "science",
    "committee",
    "moment",
    "fix",
    "teaching",
    "dig",
    "specialist",
    "complex",
    "guide",
    "people",
    "dead",
    "voice",
    "original",
    "break",
    "topic",
    "data",
    "degree",
    "reading",
    "recording",
    "bunch",
    "reach",
    "judgment",
    "lie",
    "regular",
    "set",
    "painting",
    "mode",
    "list",
    "player",
    "bear",
    "north",
    "wonder",
    "carpet",
    "heavy",
    "officer",
    "negative",
    "clock",
    "unique",
    "baby",
    "pain",
    "assumption",
    "disk",
    "iron",
    "bill",
    "drawer",
    "look",
    "double",
    "mistake",
    "finish",
    "future",
    "brilliant",
    "contact",
    "math",
    "rice",
    "leave",
    "restaurant",
    "discount",
    "sex",
    "virus",
    "bit",
    "trust",
    "event",
    "wear",
    "juice",
    "failure",
    "bug",
    "context",
    "mud",
    "whole",
    "wrap",
    "intention",
    "draft",
    "pressure",
    "cake",
    "dark",
    "explanation",
    "space",
    "angle",
    "word",
    "efficiency",
    "management",
    "habit",
    "star",
    "chance",
    "finding",
    "transportation",
    "stand",
    "criticism",
    "flow",
    "door",
    "injury",
    "insect",
    "surprise",
    "apartment",
    "західний",
    "речення",
    "сигнал",
    "сміття",
    "місце",
    "протилежний",
    "дно",
    "картопля",
    "адміністрація",
    "робочий",
    "ласкаво",
    "ранок",
    "добрий",
    "агенція",
    "первинний",
    "бажання",
    "відповідальність",
    "прес",
    "проблема",
    "президент",
    "вкрасти",
    "щітка",
    "читати",
    "тип",
    "удар",
    "тренер",
    "зростання",
    "замок",
    "кістка",
    "справа",
    "рівний",
    "зручний",
    "регіон",
    "заміна",
    "виконання",
    "друг",
    "ходити",
    "ліки",
    "фільм",
    "річ",
    "камінь",
    "стук",
    "загальний",
    "конкуренція",
    "легкість",
    "південь",
    "установлення",
    "збирати",
    "паркування",
    "світ",
    "достатньо",
    "дихання",
    "претензія",
    "алкоголь",
    "торгівля",
    "дорогий",
    "підкреслення",
    "вулиця",
    "матерія",
    "рішення",
    "безлад",
    "угода",
    "студія",
    "тренер",
    "допомога",
    "мозок",
    "крила",
    "стиль",
    "приватний",
    "верх",
    "коричневий",
    "нога",
    "купити",
    "процедура",
    "метод",
    "швидкість",
    "високий",
    "компанія",
    "цінний",
    "пиріг",
    "аналітик",
    "сесія",
    "шаблон",
    "район",
    "задоволення",
    "вечеря",
    "плавання",
    "жарт",
    "замовлення",
    "тарілка",
    "департамент",
    "двигун",
    "клітина",
    "витрачати",
    "кабінет",
    "різниця",
    "влада",
    "екзамен",
    "двигун",
    "кінь",
    "вимір",
    "платити",
    "палець",
    "крива",
    "література",
    "турбувати",
    "вогонь",
    "можливість",
    "дебати",
    "діяльність",
    "прохід",
    "привіт",
    "цикл",
    "фон",
    "тихий",
    "автор",
    "ефект",
    "актор",
    "сторінка",
    "велосипед",
    "помилка",
    "горло",
    "атака",
    "характер",
    "телефон",
    "чай",
    "збільшення",
    "результат",
    "файл",
    "конкретний",
    "інспектор",
    "внутрішній",
    "потенціал",
    "персонал",
    "будівля",
    "роботодавець",
    "черевик",
    "рука",
    "напрямок",
    "сад",
    "покупка",
    "інтерв'ю",
    "дослідження",
    "визнання",
    "член",
    "духовний",
    "духовка",
    "сендвіч",
    "дивний",
    "пасажир",
    "конкретний",
    "відповідь",
    "реакція",
    "розмір",
    "варіація",
    "а",
    "скасувати",
    "цукерка",
    "вихід",
    "гість",
    "умова",
    "літати",
    "ціна",
    "слабкість",
    "перетворити",
    "готель",
    "великий",
    "рот",
    "розум",
    "пісня",
    "цукор",
    "підозрювати",
    "телефон",
    "вухо",
    "дах",
    "фарба",
    "холодильник",
    "організація",
    "журі",
    "нагорода",
    "інженерія",
    "день",
    "власність",
    "команда",
    "бар",
    "дорога",
    "опис",
    "свято",
    "бал",
    "позначка",
    "літера",
    "душ",
    "пропозиція",
    "пан",
    "удача",
    "національний",
    "прогрес",
    "зал",
    "інсульт",
    "теорія",
    "пропозиція",
    "історія",
    "поїздка",
    "середина",
    "відкриття",
    "скло",
    "ліфт",
    "шлунок",
    "питання",
    "здатність",
    "лідерство",
    "село",
    "комп'ютер",
    "місто",
    "великий",
    "довіра",
    "свічка",
    "священик",
    "рекомендація",
    "точка",
    "необхідний",
    "тіло",
    "стіл",
    "секрет",
    "жах",
    "шум",
    "культура",
    "попередження",
    "вода",
    "коло",
    "дієта",
    "квітка",
    "автобус",
    "важкий",
    "дозвіл",
    "тиждень",
    "підказка",
    "зв'язок",
    "зловживання",
    "висота",
    "зберегти",
    "кут",
    "кордон",
    "стрес",
    "водити",
    "зупинити",
    "розірвати",
    "їжа",
    "слухати",
    "плутанина",
    "подруга",
    "життя",
    "відношення",
    "значення",
    "план",
    "креативний",
    "атмосфера",
    "звинувачувати",
    "запросити",
    "житло",
    "папір",
    "пити",
    "катати",
    "срібло",
    "п'яний",
    "вік",
    "пошкодження",
    "дим",
    "середовище",
    "упаковка",
    "заощадження",
    "вплив",
    "турист",
    "дощ",
    "пост",
    "знак",
    "бабуся",
    "бігти",
    "прибуток",
    "штовхати",
    "клерк",
    "остання",
    "вино",
    "плавати",
    "перерва",
    "речі",
    "співак",
    "похорон",
    "середній",
    "джерело",
    "сцена",
    "традиція",
    "особистий",
    "сніг",
    "ніхто",
    "відстань",
    "сорт",
    "чутливий",
    "тварина",
    "основний",
    "переговори",
    "клік",
    "настрій",
    "період",
    "прибуття",
    "висловлення",
    "свято",
    "повторити",
    "пил",
    "шафа",
    "золото",
    "поганий",
    "парус",
    "комбінація",
    "одяг",
    "акцент",
    "обов'язок",
    "чорний",
    "крок",
    "школа",
    "стрибок",
    "документ",
    "професійний",
    "губа",
    "хімічний",
    "фронт",
    "прокидатися",
    "поки",
    "внутрішній",
    "годинник",
    "ряд",
    "предмет",
    "штраф",
    "баланс",
    "можливий",
    "дорослий",
    "вбік",
    "зразок",
    "апеляція",
    "весілля",
    "глибина",
    "король",
    "нагорода",
    "дружина",
    "удар",
    "сайт",
    "табір",
    "музика",
    "безпечний",
    "подарунок",
    "недолік",
    "вгадати",
    "вчинок",
    "сором",
    "драма",
    "капітал",
    "екзамен",
    "дурний",
    "запис",
    "звук",
    "коливання",
    "роман",
    "мінімум",
    "співвідношення",
    "машина",
    "форма",
    "вести",
    "операція",
    "зарплата",
    "хмара",
    "справа",
    "удар",
    "глава",
    "група",
    "трафік",
    "удар",
    "аналіз",
    "аеропорт",
    "час",
    "відпустка",
    "філософія",
    "куля",
    "грудь",
    "дякую",
    "місце",
    "гора",
    "реклама",
    "червоний",
    "минуле",
    "оренда",
    "повернення",
    "тур",
    "будинок",
    "будівництво",
    "мережа",
    "корінний",
    "війна",
    "фігура",
    "плата",
    "спрей",
    "користувач",
    "бруд",
    "постріл",
    "завдання",
    "паличка",
    "друг",
    "програмне",
    "просування",
    "взаємодія",
    "оточувати",
    "блок",
    "мета",
    "практика",
    "конфлікт",
    "рутина",
    "вимога",
    "бонус",
    "діра",
    "держава",
    "молодший",
    "солодкий",
    "ловити",
    "сльоза",
    "складати",
    "стіна",
    "редактор",
    "життя",
    "позиція",
    "фунт",
    "повага",
    "ванна",
    "пальто",
    "сценарій",
    "робота",
    "вчити",
    "народження",
    "вид",
    "вирішувати",
    "тема",
    "працівник",
    "сумнів",
    "ринок",
    "освіта",
    "служити",
    "відновити",
    "тон",
    "шкода",
    "пропустити",
    "союз",
    "розуміння",
    "корова",
    "річка",
    "асоціація",
    "концепція",
    "тренування",
    "рецепт",
    "відношення",
    "резерв",
    "депресія",
    "доказ",
    "волосся",
    "дохід",
    "незалежний",
    "піднімати",
    "завдання",
    "тимчасовий",
    "кількість",
    "втрата",
    "край",
    "шлях",
    "перевірка",
    "канат",
    "оцінка",
    "забруднення",
    "стабільний",
    "повідомлення",
    "доставка",
    "перспектива",
    "дзеркало",
    "асистент",
    "представник",
    "свідок",
    "природа",
    "суддя",
    "фрукт",
    "порада",
    "диявол",
    "місто",
    "надзвичайний",
    "верхній",
    "падіння",
    "залишатися",
    "людський",
    "шия",
    "дослідник",
    "мережа",
    "співати",
    "опиратися",
    "ліга",
    "подорож",
    "підпис",
    "адвокат",
    "важливість",
    "газ",
    "вибір",
    "інженер",
    "успіх",
    "частина",
    "зовнішній",
    "робітник",
    "простий",
    "квартал",
    "студент",
    "серце",
    "проходити",
    "незважаючи",
    "зміна",
    "грубий",
    "леді",
    "трава",
    "спільнота",
    "гараж",
    "молодь",
    "стандарт",
    "спідниця",
    "обіцянка",
    "сліпий",
    "телебачення",
    "хвороба",
    "комісія",
    "позитивний",
    "енергія",
    "спокійний",
    "присутність",
    "мелодія",
    "основа",
    "перевага",
    "голова",
    "загальний",
    "різати",
    "десь",
    "презентація",
    "поточний",
    "думка",
    "революція",
    "зусилля",
    "мастер",
    "впроваджувати",
    "республіка",
    "поверх",
    "принцип",
    "незнайомець",
    "плече",
    "оцінка",
    "кнопка",
    "теніс",
    "поліція",
    "колекція",
    "рахунок",
    "реєстрація",
    "рукавичка",
    "ділити",
    "професор",
    "крісло",
    "пріоритет",
    "поєднувати",
    "мир",
    "розширення",
    "можливо",
    "вечір",
    "рамка",
    "сестра",
    "хвиля",
    "код",
    "заявка",
    "миша",
    "матч",
    "контур",
    "пляшка",
    "половина",
    "щока",
    "резолюція",
    "назад",
    "знання",
    "робити",
    "обговорення",
    "гвинт",
    "довжина",
    "нещасний випадок",
    "бій",
    "одяг",
    "коліно",
    "колода",
    "упаковка",
    "це",
    "повернути",
    "слух",
    "газета",
    "шар",
    "багатство",
    "профіль",
    "уявлення",
    "відповідь",
    "вихідні",
    "вчитель",
    "зовнішність",
    "зустріч",
    "велосипед",
    "зростати",
    "ремінь",
    "аварія",
    "чаша",
    "обслуговування",
    "підтримка",
    "зображення",
    "вірш",
    "ризик",
    "захоплення",
    "віддалений",
    "секретар",
    "публіка",
    "виробляти",
    "літак",
    "дисплей",
    "гроші",
    "пісок",
    "ситуація",
    "удар",
    "клієнт",
    "назва",
    "трусити",
    "іпотека",
    "варіант",
    "номер",
    "поп",
    "вікно",
    "ступінь",
    "нічого",
    "досвід",
    "думка",
    "вихід",
    "танець",
    "вказівка",
    "хлопець",
    "матеріал",
    "група",
    "лідер",
    "сонце",
    "красивий",
    "м'яз",
    "фермер",
    "різноманіття",
    "жир",
    "ручка",
    "директор",
    "можливість",
    "календар",
    "зовні",
    "темп",
    "ванна",
    "риба",
    "наслідок",
    "поставити",
    "власник",
    "йти",
    "лікар",
    "інформація",
    "поділитися",
    "поранити",
    "захист",
    "кар'єра",
    "фінанси",
    "сила",
    "гольф",
    "сміття",
    "аспект",
    "дитина",
    "їжа",
    "черевик",
    "молоко",
    "відповідати",
    "об'єктив",
    "реальність",
    "сирий",
    "кільце",
    "торговий центр",
    "один",
    "вплив",
    "область",
    "новини",
    "міжнародний",
    "серія",
    "вразити",
    "мати",
    "притулок",
    "удар",
    "позика",
    "місяць",
    "місце",
    "будь-що",
    "розваги",
    "знайомий",
    "підказка",
    "рік",
    "радий",
    "супермаркет",
    "природний",
    "бог",
    "вартість",
    "розмова",
    "пов'язка",
    "зруйнувати",
    "комфорт",
    "земля",
    "шторм",
    "відсоток",
    "допомога",
    "бюджет",
    "сила",
    "початок",
    "сон",
    "інший",
    "молодий",
    "одиниця",
    "заповнити",
    "магазин",
    "бажання",
    "сховати",
    "вартість",
    "чашка",
    "обслуговування",
    "медсестра",
    "функція",
    "вежа",
    "роль",
    "клас",
    "камера",
    "база даних",
    "паніка",
    "нація",
    "кошик",
    "лід",
    "мистецтво",
    "дух",
    "графік",
    "обмін",
    "зворотній зв'язок",
    "заява",
    "репутація",
    "пошук",
    "полювання",
    "вправа",
    "огидний",
    "повідомлення",
    "чоловічий",
    "двір",
    "річний",
    "комір",
    "дата",
    "платформа",
    "рослина",
    "фортуна",
    "пристрасть",
    "дружба",
    "поширення",
    "рак",
    "квиток",
    "ставлення",
    "острів",
    "активний",
    "об'єкт",
    "послуга",
    "покупець",
    "укус",
    "картка",
    "обличчя",
    "стейк",
    "пропозиція",
    "пацієнт",
    "тепло",
    "правило",
    "мешканець",
    "широкий",
    "політика",
    "захід",
    "ніж",
    "експерт",
    "дівчина",
    "дизайн",
    "сіль",
    "бейсбол",
    "схопити",
    "інспекція",
    "кузен",
    "пара",
    "журнал",
    "готувати",
    "залежний",
    "безпека",
    "курка",
    "версія",
    "валюта",
    "сходи",
    "схема",
    "кухня",
    "працевлаштування",
    "місцевий",
    "увага",
    "менеджер",
    "факт",
    "покриття",
    "сумний",
    "охоронець",
    "родич",
    "округ",
    "ставка",
    "обід",
    "програма",
    "ініціатива",
    "передача",
    "грудь",
    "розмова",
    "страх",
    "підтримка",
    "підтримка",
    "клуб",
    "дочка",
    "зона",
    "дотик",
    "сьогодні ввечері",
    "шок",
    "горіти",
    "вибачення",
    "ім'я",
    "опитування",
    "ландшафт",
    "просування",
    "задоволення",
    "хліб",
    "катастрофа",
    "предмет",
    "капелюх",
    "пріоритет",
    "шопінг",
    "візит",
    "схід",
    "фото",
    "дім",
    "ідея",
    "батько",
    "порівняння",
    "кіт",
    "трубка",
    "переможець",
    "рахунок",
    "озеро",
    "бій",
    "приз",
    "фонд",
    "собака",
    "тримати",
    "ідеальний",
    "вентилятор",
    "боротися",
    "піковий",
    "безпека",
    "рішення",
    "пекло",
    "висновок",
    "населення",
    "напруга",
    "сигналізація",
    "вимірювання",
    "другий",
    "потяг",
    "перегони",
    "термін",
    "через",
    "страхування",
    "бос",
    "дерево",
    "монітор",
    "хворий",
    "курс",
    "тягнути",
    "призначення",
    "слайс",
    "все ще",
    "допомога",
    "терпіння",
    "багатий",
    "втеча",
    "емоція",
    "королівський",
    "жіночий",
    "дитинство",
    "уряд",
    "зображення",
    "буде",
    "шкарпетка",
    "великий",
    "ворота",
    "нафта",
    "перетин",
    "шпилька",
    "покращення",
    "чемпіонат",
    "смішний",
    "допомога",
    "небо",
    "подача",
    "чоловік",
    "діамант",
    "найбільший",
    "перехід",
    "робота",
    "наука",
    "комітет",
    "момент",
    "виправити",
    "викладання",
    "копати",
    "спеціаліст",
    "складний",
    "посібник",
    "люди",
    "мертвий",
    "голос",
    "оригінальний",
    "перерва",
    "тема",
    "дані",
    "ступінь",
    "читання",
    "запис",
    "пачка",
    "досягати",
    "судження",
    "брехня",
    "регулярний",
    "набір",
    "живопис",
    "режим",
    "список",
    "гравець",
    "ведмідь",
    "північ",
    "диво",
    "килим",
    "важкий",
    "офіцер",
    "негативний",
    "годинник",
    "унікальний",
    "дитина",
    "біль",
    "припущення",
    "диск",
    "залізо",
    "рахунок",
    "ящик",
    "вигляд",
    "подвійний",
    "помилка",
    "закінчити",
    "майбутнє",
    "блискучий",
    "контакт",
    "математика",
    "рис",
    "залишити",
    "ресторан",
    "знижка",
    "стать",
    "вірус",
    "кусок",
    "довіра",
    "подія",
    "носити",
    "сік",
    "невдача",
    "помилка",
    "контекст",
    "бруд",
    "цілий",
    "обгортати",
    "наміри",
    "чернетка",
    "тиск",
    "торт",
    "темний",
    "пояснення",
    "простір",
    "кут",
    "слово",
    "ефективність",
    "управління",
    "звичка",
    "зірка",
    "шанс",
    "знаходження",
    "транспорт",
    "стояти",
    "критика",
    "потік",
    "двері",
    "травма",
    "комаха",
    "сюрприз",
    "квартира"
]  # pylint: disable=line-too-long

# ISO 639-1 codes to language names.
LANGUAGE_CODES = immutabledict.immutabledict(
    {
        "en": "English",
        "es": "Spanish",
        "pt": "Portuguese",
        "ar": "Arabic",
        "hi": "Hindi",
        "fr": "French",
        "ru": "Russian",
        "de": "German",
        "ja": "Japanese",
        "it": "Italian",
        "bn": "Bengali",
        "uk": "Ukrainian",
        "th": "Thai",
        "ur": "Urdu",
        "ta": "Tamil",
        "te": "Telugu",
        "bg": "Bulgarian",
        "ko": "Korean",
        "pl": "Polish",
        "he": "Hebrew",
        "fa": "Persian",
        "vi": "Vietnamese",
        "ne": "Nepali",
        "sw": "Swahili",
        "kn": "Kannada",
        "mr": "Marathi",
        "gu": "Gujarati",
        "pa": "Punjabi",
        "ml": "Malayalam",
        "fi": "Finnish",
    }
)

# _ALPHABETS = "([A-Za-z])"
_ALPHABETS = "([A-Za-zА-Яа-яІіЇїЄєҐґ])"
_PREFIXES = "(Mr|St|Mrs|Ms|Dr|Пан|Пані|Міс|Доктор)[.]"
_SUFFIXES = "(Inc|Ltd|Jr|Sr|Co|ТОВ|ПП|МП|ФОП)"
# _STARTERS = r"(Mr|Mrs|Ms|Dr|Prof|Capt|Cpt|Lt|He\s|She\s|It\s|They\s|Their\s|Our\s|We\s|But\s|However\s|That\s|This\s|Wherever)"
_STARTERS = r"(Mr|Mrs|Ms|Dr|Prof|Capt|Cpt|Lt|He\s|She\s|It\s|They\s|Their\s|Our\s|We\s|But\s|However\s|That\s|This\s|Wherever|Пан|Пані|Міс|Доктор|Проф|Капітан|Він\s|Вона\s|Це\s|Вони\s|Їх\s|Наш\s|Ми\s|Але\s|Проте\s|Що\s|Це\s|Де б не)"
# _ACRONYMS = "([A-Z][.][A-Z][.](?:[A-Z][.])?)"
_ACRONYMS = "([A-Z][.][A-Z][.](?:[A-Z][.])?|[А-Я][.][А-Я][.](?:[А-Я][.])?)"
_WEBSITES = "[.](com|net|org|io|gov|edu|me)"
_DIGITS = "([0-9])"
_MULTIPLE_DOTS = r"\.{2,}"



def split_into_sentences(text):
    """Split the text into sentences.

    Args:
      text: A string that consists of more than or equal to one sentences.

    Returns:
      A list of strings where each string is a sentence.
    """
    text = " " + text + "  "
    text = text.replace("\n", " ")
    text = re.sub(_PREFIXES, "\\1<prd>", text)
    text = re.sub(_WEBSITES, "<prd>\\1", text)
    text = re.sub(_DIGITS + "[.]" + _DIGITS, "\\1<prd>\\2", text)
    text = re.sub(
        _MULTIPLE_DOTS,
        lambda match: "<prd>" * len(match.group(0)) + "<stop>",
        text,
    )
    if "Ph.D" in text:
        text = text.replace("Ph.D.", "Ph<prd>D<prd>")
    text = re.sub(r"\s" + _ALPHABETS + "[.] ", " \\1<prd> ", text)
    text = re.sub(_ACRONYMS + " " + _STARTERS, "\\1<stop> \\2", text)
    text = re.sub(
        _ALPHABETS + "[.]" + _ALPHABETS + "[.]" + _ALPHABETS + "[.]",
        "\\1<prd>\\2<prd>\\3<prd>",
        text,
    )
    text = re.sub(_ALPHABETS + "[.]" + _ALPHABETS + "[.]", "\\1<prd>\\2<prd>", text)
    text = re.sub(" " + _SUFFIXES + "[.] " + _STARTERS, " \\1<stop> \\2", text)
    text = re.sub(" " + _SUFFIXES + "[.]", " \\1<prd>", text)
    text = re.sub(" " + _ALPHABETS + "[.]", " \\1<prd>", text)
    if "”" in text:
        text = text.replace(".”", "”.")
    if '"' in text:
        text = text.replace('."', '".')
    if "!" in text:
        text = text.replace('!"', '"!')
    if "?" in text:
        text = text.replace('?"', '"?')
    text = text.replace(".", ".<stop>")
    text = text.replace("?", "?<stop>")
    text = text.replace("!", "!<stop>")
    text = text.replace("<prd>", ".")
    sentences = text.split("<stop>")
    sentences = [s.strip() for s in sentences]
    if sentences and not sentences[-1]:
        sentences = sentences[:-1]
    return sentences


def count_words(text):
    """Counts the number of words."""
    tokenizer = nltk.tokenize.RegexpTokenizer(r"\w+")
    tokens = tokenizer.tokenize(text)
    num_words = len(tokens)
    return num_words


@functools.lru_cache(maxsize=None)
def _get_sentence_tokenizer():
    return nltk.data.load("nltk:tokenizers/punkt/english.pickle")


def count_sentences(text):
    """Count the number of sentences."""
    tokenizer = _get_sentence_tokenizer()
    tokenized_sentences = tokenizer.tokenize(text)
    return len(tokenized_sentences)


def generate_keywords(num_keywords):
    """Randomly generates a few keywords."""
    return random.sample(WORD_LIST, k=num_keywords)
